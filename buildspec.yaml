version: 0.2

env:
  variables:
    S3_BUCKET: "br.com.likwi.artifacts.apps.backend-site-dev"
    PACKAGE: "backend-site"

phases:
  pre_build:
    commands:
      - echo "Setting GOXX variables ðŸ––"
      - export GOOS=linux
      - export GOARCH=amd64
      - export CGO_ENABLED=0
      - echo "ðŸš€ -> ðŸª£"
      - go mod tidy
      - go get -t ./...
      - go vet ./...
      - go test ./...

  build:
    commands:
      - env
      - go build *.go

      # Use the amazonlinux:2 Docker image for packaging
      - docker run --rm -v $(pwd):/app -w /app amazonlinux:2 bash -c "yum install -y zip && zip -r deployment.zip ./*"
      - mv deployment.zip packaged.yaml

artifacts:
  files:
    - packaged.yaml
